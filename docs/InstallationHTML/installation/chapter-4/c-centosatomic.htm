<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta name="copyright" content="(C) Copyright 2005" />
<meta name="DC.rights.owner" content="(C) Copyright 2005" />
<meta content="concept" name="DC.Type" />
<meta name="DC.Title" content="Registering the CentOS Atomic Host Image" />
<meta scheme="URI" name="DC.Relation" content="../../installation/chapter-4/c-install.htm" />
<meta content="XHTML" name="DC.Format" />
<meta content="About" name="DC.Identifier" />
<meta content="en-us" name="DC.Language" />
<link href="../../commonltr.css" type="text/css" rel="stylesheet" />
<link href="../../book.css" type="text/css" rel="stylesheet" />
<title>Registering the CentOS Atomic Host Image</title>
</head>
<body id="About">


    <h1 class="topictitle1">Registering the CentOS Atomic Host Image</h1>

    <div>
        <div class="section">
            <p>As a first step in the manual installation of <span>CLC</span>, you need to upload and register the preassembled <span>CLC</span> Atomic host base image for the cluster nodes in your OpenStack instance. </p>

            <p>You can use the OpenStack dashboard or the OpenStanck <samp class="codeph">glance</samp> command for registering the preassembled base image for cluster nodes. </p>

            <p>The image is provided in the <samp class="codeph">&lt;InstDir&gt;/manual-installation/image</samp> folder.</p>

        </div>

        <div class="section"><h4 class="sectiontitle">Registering the Image Using the OpenStack Dashboard</h4>
            
            <p>To register the CentOS Atomic host image using the OpenStack dashboard, proceed as follows: </p>

            <div class="p">
                <ol>
                    <li class="liexpand">Login to the OpenStack dashboard as an administrator. </li>

                    <li class="liexpand">Go to <strong>Admin &gt; System &gt; Images</strong>. </li>

                    <li class="liexpand">Click <strong>Create Image</strong> and create the image with the following parameters: <div class="p">
                            <ul>
                                <li class="liexpand"><strong>Name</strong>: <samp class="codeph">WLM:Atomic</samp> (mandatory). Do not specify a different name!</li>

                                <li class="liexpand"><strong>Description</strong> of the image (optional)</li>

                                <li class="liexpand"><strong>Image Source</strong>: Select <strong>Image File</strong> from the drop-down list and browse for the image file. <p>The file is located in the <samp class="codeph">&lt;InstDir&gt;/manual-installation/image</samp> folder and called <samp class="codeph">centos-atomic-host-7.qcow2</samp>.</p>
</li>

                                <li class="liexpand"><strong>Format</strong>: <samp class="codeph">QCOW2 - QEMU Emulator</samp> (mandatory). Do not specify a different disk format!</li>

                                <li class="liexpand"><strong>Minimum Disk (GB)</strong>: 10 (recommended because this value is used to filter out flavors that are not large enough for clusters. A flavor must be chosen when a cluster is created.)</li>

                                <li class="liexpand"><strong>Minimum RAM (MB)</strong>: 1024 (recommended - see above) </li>

                                <li class="liexpand">Select <strong>Public</strong> to make the image public to all users (mandatory). </li>

                            </ul>

                        </div>
</li>

                    <li class="liexpand">Click <strong>Create Image</strong>. </li>

                </ol>

            </div>

            <p>The image is queued to be uploaded. It may take several minutes before the status changes to <samp class="codeph">Active</samp>.</p>

        </div>

        <div class="section"><h4 class="sectiontitle">Registering the Image using the CLI</h4>
            
            <p>You must have the appropriate credentials for the Glance client configuration if you want to use the OpenStack Glance client to make queries against your OpenStack cloud. For registering the <span>CLC</span> CentOS Atomic host image using the Glance client, you need to set the required environment variables for the Glance client.</p>

            <p>To do so, you must create an environment file called OpenStack RC file or <samp class="codeph">openrc.sh</samp> file. This project-specific environment file contains the credentials that all OpenStack services use. When you source the file, environment variables are set for your current shell. The variables enable the OpenStack client commands to communicate with the OpenStack services that run in the cloud.</p>

            <p><strong>To set the environment variables, download, and source the OpenStack RC file</strong>:</p>

            <div class="p">
                <ol>
                    <li class="liexpand">Log in to the OpenStack dashboard as an administrator.</li>

                    <li class="liexpand">Select the project for which you want to download the OpenStack RC file, and click <strong>Project &gt; Compute &gt; Access &amp; Security</strong>.</li>

                    <li class="liexpand">On the <strong>API Access</strong> tab, click <strong>Download OpenStack RC File</strong> to generate the environment file for in your shell with the environment variables the Glance client requires to know where your service endpoints and your authentication information are. </li>

                    <li class="liexpand">Save the file to the OpenStack host where the Horizon service is running, for example, to the <samp class="codeph">&lt;InstDir&gt;</samp> folder. <p>The file name is <samp class="codeph">&lt;project&gt;-openrc.sh</samp>, where <samp class="codeph">&lt;project&gt;</samp> is the name of the project for which you downloaded the file. </p>
</li>

                    <li class="liexpand">On the shell from which you want to execute OpenStack commands, source the <samp class="codeph">&lt;project&gt;-openrc.sh</samp> file for the respective project. <p>In the following example, the file is sourced for the <samp class="codeph">admin</samp> project: </p>
<div class="p">
                            <pre class="codeblock">source admin-openrc.sh</pre>

                        </div>
</li>

                    <li class="liexpand">When you are prompted for an OpenStack password, enter the password of the user who downloaded the <samp class="codeph">&lt;project&gt;-openrc.sh</samp> file. </li>

                </ol>

            </div>

            <p>Below you find a sample file, <samp class="codeph">admin-openrc.sh</samp>.</p>

            <div class="p">
<div class="tablenoborder"><table summary="" cellspacing="0" cellpadding="4" frame="void" border="1" rules="all">
                        
                        <tbody>
                            <tr>
                                <td class="nocellnorowborder" valign="top" width="100%">
                                    <pre class="codeblock">export OS_AUTH_URL=http://203.0.113.10:5000/v2.0
export OS_TENANT_ID=98333aba48e756fa8f629c83a818ad57
export OS_TENANT_NAME="admin"
export OS_USERNAME=demo
read -s OS_PASSWORD_INPUT
export OS_PASSWORD=$OS_PASSWORD_INPUT</pre>

                                </td>

                            </tr>

                        </tbody>

                    </table>
</div>
where:</div>

            <ul>
                <li><samp class="codeph">OS_AUTH_URL</samp> is the URL of your Keystone authentication server.</li>

                <li><samp class="codeph">OS_TENANT_ID</samp> is the ID of the project you use for the provisioning of clusters.</li>

                <li><samp class="codeph">OS_TENANT_NAME</samp> is the name of the project you use for the provisioning of clusters.</li>

                <li><samp class="codeph">OS_USERNAME</samp> is the OpenStack name of the user who installs <span>CLC</span>.</li>

                <li><samp class="codeph">read -s OS_PASSWORD_INPUT</samp><p><samp class="codeph">export OS_PASSWORD=$OS_PASSWORD_INPUT</samp></p>
<p>The password is not stored as plain text. When you source or run the script, it prompts you for your password and stores it in the environment variable <samp class="codeph">OS_PASSWORD</samp>. It is important to note that this requires interaction. It is possible to store a value directly in the script if you require a non-interactive operation, but you then need to be extremely cautious regarding the security and permissions of this file.</p>
</li>

            </ul>

            <p><strong>To register the CentOS Atomic host image</strong>:</p>

            <p>Execute the following <samp class="codeph">glance</samp> command: </p>

            <div class="p">
                
<div class="tablenoborder"><table summary="" cellspacing="0" cellpadding="4" frame="void" border="1" rules="all">
                        
                        <tbody>
                            <tr>
                                <td class="nocellnorowborder" valign="top" width="100%">
                                    <pre class="codeblock">glance image-create --name=WLM:Atomic --min-disk=10 --min-ram=1024 \
  --container-format=bare --disk-format=qcow2 \
  --file &lt;Atomic host imagefile&gt;  --is-public true</pre>

                                </td>

                            </tr>

                        </tbody>

                    </table>
</div>

            </div>

            <p>where: </p>

            <div class="p">
                <ul>
                    <li><samp class="codeph">name=WLM:Atomic</samp> is mandatory. Do not specify a different name!</li>

                    <li><samp class="codeph">min_disk</samp> and <samp class="codeph">min_ram</samp> are recommended because these values are used to filter out flavors that are not large enough for clusters. A flavor must be chosen when a cluster is created. The values define the minimum disk space and RAM allocated for the image. </li>

                    <li><samp class="codeph">container-format=bare</samp> is the default for Docker containers.</li>

                    <li><samp class="codeph">disk-format=qcow2</samp> is mandatory. Do not specifiy a different disk format.</li>

                    <li><samp class="codeph">file</samp> is the CentOS Atomic host image file located in <samp class="codeph">&lt;InstDir&gt;/manual-installation/image</samp></li>

                    <li><samp class="codeph">is-public true</samp> is mandatory.</li>

                </ul>

            </div>

            <p><strong>To confirm that the image was registered</strong>:</p>

            <p>Execute the following <samp class="codeph">glance</samp> command: </p>

            <div class="p">
                <pre class="codeblock">glance image-list</pre>

            </div>

            <p>This command shows the attributes of the newly created <span>CLC</span> image.</p>

        </div>

    </div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="../../installation/chapter-4/c-install.htm">Manually Installing CLC</a></div>
</div>
</div>

</body>
</html>